automation:
- alias: Kitchen - Always on
  id: f711c2a0-4b8a-4aed-b8bb-5a2ce62aed4f
  description: ''
  use_blueprint:
    path: EdwardTFN/always_on.yaml
    input:
      timeout: 60
      entities_list:
      - switch.kitchen_cooker_hood
- alias: Kitchen - Bench - Lights - Motion
  id: '1642333235058'
  description: ''
  use_blueprint:
    path: EdwardTFN/light_motion_illuminance_2_levels.yaml
    input:
      max_lumens: 15
      no_motion_wait_to_dimming: 60
      light_level_high: 100
      light_level_dimmer: 35
      motion_entity: binary_sensor.kitchen_bench_motion_occupancy
      lumens_entity: sensor.kitchen_bench_motion_light_level
      light_target: light.kitchen_bench_lights
      no_motion_wait_to_off: 15
      occupancy_ratio_entity: sensor.kitchen_table_motion_ratio_in_the_last_10m
      occupancy_ratio_threshold: 40
      pause_entities_on:
      - input_boolean.home_party_mode
- alias: Kitchen - Bench - Lights - Wall switch
  id: '1661932329651'
  description: ''
  use_blueprint:
    path: EdwardTFN/light_switch_toggle.yaml
    input:
      input_entity: binary_sensor.kitchen_ceiling_lights_windows_lights_input
      light_target: light.kitchen_bench_lights
- alias: Kitchen - Bench - Lights - turn off all together
  id: '1638880572560'
  trigger:
  - platform: device
    type: turned_off
    device_id: d398de22fe0839ccde27872343e1e05b
    entity_id: light.kitchen_bench_left_light
    domain: light
    for:
      hours: 0
      minutes: 0
      seconds: 1
  - platform: device
    type: turned_off
    device_id: a1a8cf45cfc1e7d7ce9a42e2b5248e27
    entity_id: light.kitchen_bench_right_light
    domain: light
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: or
    conditions:
    - condition: device
      type: is_on
      device_id: d398de22fe0839ccde27872343e1e05b
      entity_id: light.kitchen_bench_left_light
      domain: light
    - condition: device
      type: is_on
      device_id: a1a8cf45cfc1e7d7ce9a42e2b5248e27
      entity_id: light.kitchen_bench_right_light
      domain: light
  action:
  - service: light.turn_off
    data:
      transition: 5
    target:
      device_id:
      - d398de22fe0839ccde27872343e1e05b
      - a1a8cf45cfc1e7d7ce9a42e2b5248e27
  mode: single
- alias: Kitchen - Cooktop - Align status on 3-phases
  id: '1663411091899'
  description: ''
  use_blueprint:
    path: EdwardTFN/set_entities_based_on_other_entities.yaml
    input:
      input_entities:
      - switch.kitchen_cooktop_l1_outlet
      - switch.kitchen_cooktop_l2_outlet
      - switch.kitchen_cooktop_l3_outlet
      - switch.kitchen_cooker_hood
      target_entities:
      - switch.kitchen_cooktop_l1_outlet
      - switch.kitchen_cooktop_l2_outlet
      - switch.kitchen_cooktop_l3_outlet
      - switch.kitchen_cooker_hood
- alias: Kitchen - Cooktop - Alarms
  id: '1656410575930'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kitchen_cooktop_l1_overheating
    - binary_sensor.kitchen_cooktop_l1_overpowering
    - binary_sensor.kitchen_cooktop_l1_overvoltage
    - binary_sensor.shellyplus1pm_7c87ce64c7b4_switch_0_overheating
    - binary_sensor.shellyplus1pm_7c87ce64c7b4_switch_0_overpowering
    - binary_sensor.shellyplus1pm_7c87ce64c7b4_switch_0_overvoltage
    - binary_sensor.shellyplus1pm_3c610579dfa8_switch_0_overheating
    - binary_sensor.shellyplus1pm_3c610579dfa8_switch_0_overpowering
    - binary_sensor.shellyplus1pm_3c610579dfa8_switch_0_overvoltage
    not_from: unavailable
    not_to: unavailable
  - platform: numeric_state
    entity_id: sensor.kitchen_cooktop_l1_device_temperature
    above: '100'
  - platform: numeric_state
    entity_id: sensor.kitchen_cooktop_l2_device_temperature
    above: '100'
  - platform: numeric_state
    entity_id: sensor.kitchen_cooktop_l3_device_temperature
    above: '100'
  condition: []
  action:
  - service: notify.signal_edward
    data:
      message: 'There is an alert in the Cooktop.

        {{ state_attr(trigger.entity_id, "friendly_name") }} is {{ states(trigger.entity_id)
        }}.'
  mode: single
- alias: Kitchen - Dishwasher - Run when price is at minimum
  id: '1640731367839'
  trigger:
  - platform: state
    entity_id:
    - sensor.electricity_price
    attribute: future_prices_16h_current_price_is_at_min
    to: 'true'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.kitchen_dishwasher_operation_state
      state: Inactive
    - condition: state
      entity_id: sensor.kitchen_dishwasher_operation_state
      state: Ready
    - condition: state
      entity_id: sensor.kitchen_dishwasher_operation_state
      state: unavailable
  - condition: template
    value_template: '{{ as_timestamp(now() - timedelta(hours=8)) >= as_timestamp(states(''input_datetime.kitchen_dishwasher_last_run''))}}'
  - condition: state
    entity_id: input_boolean.home_travelling_mode
    state: 'off'
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.kitchen_dishwasher_power
  - service: notify.signal_edward
    data:
      message: Dishwasher is starting...
    continue_on_error: true
    enabled: false
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
    continue_on_error: true
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.kitchen_dishwasher_power
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.kitchen_dishwasher_program_eco50
  - wait_for_trigger:
    - platform: state
      entity_id:
      - sensor.kitchen_dishwasher_operation_state
      to: Run
    timeout:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - if:
    - condition: state
      entity_id: sensor.kitchen_dishwasher_operation_state
      state: Run
    then:
    - service: input_datetime.set_datetime
      target:
        entity_id: input_datetime.kitchen_dishwasher_last_run
      data:
        timestamp: '{{ now().timestamp() }}'
      continue_on_error: true
    - service: notify.signal_edward
      data:
        message: Dishwasher successfully started.
      continue_on_error: true
    else:
    - service: notify.signal_group_home
      data:
        message: Failed to start the dishwasher.
      continue_on_error: true
  mode: restart
- alias: Kitchen - Refrigeration - Temperature alarm
  id: '1639343967055'
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.kitchen_freezer_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    above: -10
    id: Freezer - High
  - platform: numeric_state
    entity_id: sensor.kitchen_freezer_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    below: -19
    id: Freezer - Low
  - platform: numeric_state
    entity_id: sensor.kitchen_freezer_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    above: -19
    below: -10
    id: Freezer - Normal
  - platform: numeric_state
    entity_id: sensor.kitchen_fridge_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    above: 10.5
    id: Fridge - High
  - platform: numeric_state
    entity_id: sensor.kitchen_fridge_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    below: 1
    id: Frige - Low
  - platform: numeric_state
    entity_id: sensor.kitchen_fridge_hygrometer_temperature
    for:
      hours: 0
      minutes: 1
      seconds: 15
    above: 1
    below: 10.5
    id: Fridge - Normal
  condition: []
  action:
  - service: notify.signal_edward
    data:
      message: Refrigeration temperature alarm triggered
  - service: notify.signal_edward
    data:
      message: Triggered by {{ trigger.entity_id }} when changing from {{ trigger.from_state
        }} to {{ trigger.to_state }}. Trigger id is {{ trigger.id }}.
  - condition: not
    conditions:
    - condition: template
      value_template: '{{ trigger.from_state.state in [''unknown'', ''unavailable'']
        }}'
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: Freezer - High
        - condition: trigger
          id: Freezer - Low
        - condition: trigger
          id: Fridge - High
        - condition: trigger
          id: Fridge - Low
      sequence:
      - service: notify.signal_group_home
        data:
          message: "Abnormal temperature! \n{{ state_attr(trigger.entity_id, 'friendly_name')
            }} is {{states(trigger.entity_id) | float(-99) | round(1) }}ºC.\nPlease
            check the door and power supply."
      - service: switch.turn_on
        data: {}
        target:
          device_id: a76e3b3b1f35880f7709ec5c3f9c20c5
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: Freezer - Normal
        - condition: trigger
          id: Fridge - Normal
      sequence:
      - service: notify.signal_group_home
        data:
          message: '{{ state_attr(trigger.entity_id, ''friendly_name'') }} temperature
            is back to normal ({{states(trigger.entity_id) | float(-99) | round(1)
            }}ºC).'
  mode: single
- alias: Kitchen - Table - Lights - Motion
  id: '1668453604752'
  description: ''
  use_blueprint:
    path: EdwardTFN/light_motion_illuminance_2_levels.yaml
    input:
      motion_entity: binary_sensor.kitchen_table_motion_occupancy
      lumens_entity: sensor.kitchen_table_motion_light_level
      light_target: light.kitchen_table_lights
      light_level_high: 90
      light_level_dimmer: 25
      no_motion_wait_to_dimming: 360
      max_sun_angle: 90
      max_lumens: 50
      pause_entities_on:
      - binary_sensor.living_room_tv_is_on
      - input_boolean.home_party_mode
      #occupancy_ratio_entity: sensor.kitchen_table_motion_ratio_in_the_last_10m
      #occupancy_ratio_threshold: 10
- alias: Kitchen - Table - Lights - Wall switch
  id: '1661932373416'
  description: ''
  use_blueprint:
    path: EdwardTFN/light_switch_toggle.yaml
    input:
      input_entity: binary_sensor.kitchen_ceiling_lights_table_lights_input
      light_target: light.kitchen_table_lights
- alias: Kitchen - Windows - Announce to Alexa
  id: '1669284800498'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.kitchen_windows
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.alexa_media
    data:
      target: Kitchen
      message: The kitchen''s windows are open.
  mode: single
