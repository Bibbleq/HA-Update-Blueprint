alert:
  car_neighborhood_streets:
    name: Car parking
    message: >-
      Car is parked in the neighborhood streets for too long ({{ states('sensor.car_parking_time') }}).

      Please move it to a parking area.
    done_message: Car was moved!
    entity_id: device_tracker.car_tracker
    state: home
    repeat: 25
    can_acknowledge: true
    skip_first: true
    notifiers:
      - signal_group_artillerigatan

  car_door_unlocked:
    name: Car unlocked
    message: >-
      Car is unlocked for too long ({{ states.sensor.car_stopped_and_unlocked.last_changed.isoformat() }}).

      Please lock it as soon as possible.
    done_message: Car is now locked!
    entity_id: sensor.car_stopped_and_unlocked
    state: "unlocked"
    repeat: 2500
    can_acknowledge: true
    skip_first: true
    notifiers:
      - signal_group_artillerigatan

template:
  - sensor:
      - name: Car - Stopped and unlocked
        unique_id: 4cf3367f-b24c-469b-88d3-0e328641fe93
        availability: >-
          {{
            (states('sensor.car_door_lock_status') | default('unknown') not in ['unknown', 'unavailable', 'none'] )
            and
            (states('binary_sensor.car_is_active') | default('unknown') not in ['unknown', 'unavailable', 'none'] )
          }}
        state: >-
          {% set door_locked = states('sensor.car_door_lock_status') %}
          {% set trunk_locked = states('sensor.car_trunk_lock_status') %}
          {% set vehicle_moving = states('binary_sensor.car_is_active') %}
          {% if door_locked in ['unknown', 'unavailable', 'none'] or trunk_locked in ['unknown', 'unavailable', 'none'] or vehicle_moving in ['unknown', 'unavailable', 'none'] %}
            unknown
          {% elif vehicle_moving == 'on' %}
            moving
          {% elif door_locked == 'locked' and trunk_locked == 'locked' and vehicle_moving == 'off' %}
            locked
          {% else %}
            unlocked
          {% endif %}
